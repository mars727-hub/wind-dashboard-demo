<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Offshore Wind Farm Dashboard</title>

    <!-- 1. Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- 2. Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- 3. FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- 4. CSS Styles -->
    <style>
        :root {
            /* Theme Colors */
            --sidebar-bg: #0f172a;       
            --sidebar-border: #1e293b;   
            --sidebar-text: #f1f5f9;     
            --main-bg: #f8fafc;          
            --card-bg: #ffffff;
            --primary-blue: #0ea5e9;     
            --accent-cyan: #06b6d4;      
            --text-primary: #334155;     
            --text-secondary: #64748b;   
            
            /* Status Colors */
            --status-operational: #10b981;    
            --status-partial: #0d9488;        
            --status-construction: #f59e0b;   
            --status-planned: #6366f1;        
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Inter', sans-serif;
        }

        /* --- KEY FIX: NATURAL FLOW LAYOUT --- */
        /* Allow the page to grow as tall as needed. No hidden overflows. */
        html, body {
            min-height: 100vh;
            width: 100%;
            background-color: var(--main-bg);
            color: var(--text-primary);
            /* Important: Allow default browser scrolling */
            overflow-y: auto; 
            overflow-x: hidden;
        }

        body {
            display: flex; /* Sidebar | Main */
            align-items: flex-start; /* Align top */
        }

        /* --- Sidebar Styles --- */
        .sidebar {
            width: 320px;
            min-width: 240px;
            max-width: 500px;
            background-color: var(--sidebar-bg);
            color: var(--sidebar-text);
            display: flex;
            flex-direction: column;
            z-index: 1000;
            
            /* STICKY SIDEBAR: Stick to top while scrolling main content */
            position: sticky; 
            top: 0;
            height: 100vh; /* Sidebar stays full viewport height */
            overflow-y: auto; /* Internal scroll for sidebar items */
            
            border-right: 1px solid var(--sidebar-border);
            flex-shrink: 0;
        }

        .sidebar-header {
            padding: 24px;
            border-bottom: 1px solid var(--sidebar-border);
            background: rgba(15, 23, 42, 0.95);
            flex-shrink: 0; 
        }

        .sidebar h2 {
            font-size: 1.25rem; font-weight: 700; letter-spacing: -0.025em;
            display: flex; align-items: center; gap: 12px; color: white; line-height: 1.4;
        }
        .sidebar h2 i { color: var(--accent-cyan); }

        .sidebar-content { padding: 24px; flex: 1; }

        .filter-group { margin-bottom: 30px; }
        .filter-group label {
            display: block; margin-bottom: 10px; font-size: 0.85rem;
            font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: #94a3b8; 
        }

        .select-wrapper { position: relative; }
        .select-wrapper::after {
            content: '\f078'; font-family: 'Font Awesome 6 Free'; font-weight: 900;
            position: absolute; right: 15px; top: 50%; transform: translateY(-50%);
            color: #94a3b8; pointer-events: none; font-size: 0.8rem;
        }

        select {
            width: 100%; padding: 12px 40px 12px 15px;
            border-radius: 8px; border: 1px solid var(--sidebar-border);
            background-color: #1e293b; color: white; font-size: 0.95rem;
            cursor: pointer; appearance: none; transition: all 0.2s ease;
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        select:focus { outline: none; border-color: var(--primary-blue); box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.2); }
        select option { background-color: #0f172a; }

        .sidebar-footer {
            padding: 24px;
            background-color: #0b1120;
            border-top: 1px solid var(--sidebar-border);
            font-size: 0.8rem;
            color: #64748b;
            flex-shrink: 0;
        }
        
        .author-name {
            display: block; font-weight: 600; color: var(--accent-cyan); margin-bottom: 4px;
        }

        /* Resizer */
        .resizer {
            width: 6px; cursor: col-resize; position: absolute;
            top: 0; right: 0; bottom: 0; z-index: 1001;
            transition: background-color 0.2s;
        }
        .resizer:hover, .resizing { background-color: var(--primary-blue); }

        /* --- Main Content Styles --- */
        .main-content {
            flex: 1; 
            /* IMPORTANT: height auto allows content to push down freely */
            height: auto; 
            display: flex;
            flex-direction: column;
            padding: 32px; 
            gap: 32px; /* Increased gap for better spacing */
            min-width: 0;
            /* Removed overflow restrictions to fix Google Sites cutting off content */
        }

        .header-section {
            display: flex; justify-content: space-between; align-items: end;
            border-bottom: 1px solid #e2e8f0; padding-bottom: 20px;
        }
        .header-title { font-size: 1.8rem; font-weight: 800; color: var(--text-primary); letter-spacing: -0.03em; }
        .header-subtitle { font-size: 0.95rem; color: var(--text-secondary); margin-top: 5px; }

        /* KPI Cards */
        .kpi-container {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 24px;
        }
        .kpi-card {
            background: var(--card-bg); padding: 24px; border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05); border: 1px solid #f1f5f9;
            display: flex; flex-direction: column; position: relative; overflow: hidden;
            transition: transform 0.2s;
        }
        .kpi-card::before {
            content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%;
            background-color: var(--card-color, #ccc);
        }
        .kpi-card:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .kpi-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
        .kpi-title { font-size: 0.8rem; font-weight: 600; text-transform: uppercase; color: var(--text-secondary); }
        .kpi-icon {
            font-size: 1.2rem; color: var(--card-color); opacity: 0.8;
            background: rgba(0,0,0,0.03); width: 36px; height: 36px;
            display: flex; align-items: center; justify-content: center; border-radius: 50%;
        }
        .kpi-value { font-size: 2.2rem; font-weight: 800; color: var(--text-primary); letter-spacing: -0.03em; }

        /* Map Container */
        .map-wrapper {
            height: 600px; /* Fixed height for map */
            background: var(--card-bg); border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            position: relative; display: flex; flex-direction: column;
            overflow: hidden; border: 1px solid #e2e8f0;
        }
        #map { flex: 1; background: #eef2f6; z-index: 1; }

        /* Details Table Section */
        .details-section {
            background: var(--card-bg); border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0; 
            display: flex; flex-direction: column;
            /* Ensure it takes up space and pushes bottom margin */
            min-height: 400px; 
            margin-bottom: 50px; 
        }

        .details-header {
            padding: 20px 24px; border-bottom: 1px solid #e2e8f0;
            display: flex; justify-content: space-between; align-items: center;
            background-color: #ffffff;
        }
        .details-title { font-size: 1.1rem; font-weight: 700; color: var(--text-primary); }

        .table-container { 
            overflow-x: auto; /* Horizontal scroll for table */
            width: 100%;
        }
        
        .data-table { width: 100%; border-collapse: collapse; font-size: 0.9rem; white-space: nowrap; }
        .data-table th {
            background-color: #f8fafc; color: var(--text-secondary);
            font-weight: 600; text-transform: uppercase; font-size: 0.75rem;
            letter-spacing: 0.05em; padding: 16px 24px; text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        .data-table td { padding: 16px 24px; border-bottom: 1px solid #f1f5f9; color: var(--text-primary); }
        .data-table tbody tr:hover { background-color: #f1f5f9; cursor: pointer; }
        .data-table tbody tr:last-child td { border-bottom: none; }

        .status-badge {
            padding: 6px 10px; border-radius: 20px; font-size: 0.75rem;
            font-weight: 700; display: inline-flex; align-items: center;
            gap: 6px; letter-spacing: 0.02em; color: white;
        }
        .status-badge::before {
            content: ''; display: block; width: 6px; height: 6px;
            border-radius: 50%; background-color: white; opacity: 0.8;
        }

        /* Map UI Elements */
        .legend {
            background: rgba(255, 255, 255, 0.95); padding: 16px;
            border-radius: 8px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            font-size: 0.85rem; color: var(--text-primary); border: 1px solid #e2e8f0;
        }
        .legend strong { display: block; margin-bottom: 8px; font-size: 0.9rem; }
        .legend-item { display: flex; align-items: center; margin-bottom: 6px; }
        .legend i {
            width: 10px; height: 10px; border-radius: 50%; display: inline-block;
            margin-right: 10px; box-shadow: 0 0 0 1px rgba(0,0,0,0.1);
        }

        .leaflet-popup-content-wrapper {
            border-radius: 8px; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            padding: 0; overflow: hidden;
        }
        .leaflet-popup-content { margin: 0; width: 260px !important; }
        .tooltip-header {
            background-color: var(--sidebar-bg); color: white;
            padding: 12px 16px; font-size: 1rem; font-weight: 600;
            border-bottom: 2px solid var(--primary-blue);
        }
        .tooltip-body { padding: 16px; background: white; }
        .tooltip-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.85rem; }
        .tooltip-row:last-child { margin-bottom: 0; }
        .tooltip-label { color: var(--text-secondary); font-weight: 500; }
        .tooltip-val { font-weight: 600; color: var(--text-primary); text-align: right; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

    </style>
</head>
<body>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2><i class="fa-solid fa-wind fa-spin-pulse" style="--fa-animation-duration: 3s;"></i> Wind Power</h2>
        </div>
        
        <div class="sidebar-content">
            <div class="filter-group">
                <label for="statusFilter"><i class="fa-solid fa-filter"></i> Project Status</label>
                <div class="select-wrapper">
                    <select id="statusFilter">
                        <option value="all">All Statuses</option>
                    </select>
                </div>
            </div>

            <div class="filter-group">
                <label for="countryFilter"><i class="fa-solid fa-globe"></i> Region / Country</label>
                <div class="select-wrapper">
                    <select id="countryFilter">
                        <option value="all">Global (All)</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="sidebar-footer">
            <div class="footer-note">
                <span class="author-name">Eng. YUNG-CHEN, LIN</span>
                <span style="display:block; font-size: 0.75rem; margin-bottom: 4px;">mars38070274@gmail.com</span>
                <span style="display:block; margin-top:4px; opacity:0.7;">Offshore Wind Engineering DB</span>
                <span style="font-size:0.7rem; opacity:0.5;">Last Updated: Dec 2025</span>
            </div>
        </div>
        
        <div class="resizer" id="resizer"></div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <div class="header-section">
            <div>
                <h1 class="header-title">Global Offshore Wind Farm Dashboard</h1>
                <p class="header-subtitle">Real-time tracking of capacity, development status, and asset distribution.</p>
            </div>
            <!-- Mock User Profile -->
            <div style="display:flex; align-items:center; gap:12px;">
                <div style="text-align:right;">
                    <div style="font-weight:600; font-size:0.9rem;">Guest Engineer</div>
                    <div style="font-size:0.75rem; color:var(--text-secondary);">View Only</div>
                </div>
                <div style="width:40px; height:40px; background:#e2e8f0; border-radius:50%; display:flex; align-items:center; justify-content:center; color:var(--text-secondary);">
                    <i class="fa-solid fa-user"></i>
                </div>
            </div>
        </div>

        <!-- KPI Cards -->
        <section class="kpi-container">
            <div class="kpi-card" style="--card-color: #0ea5e9;">
                <div class="kpi-header">
                    <span class="kpi-title">Total Capacity</span>
                    <div class="kpi-icon"><i class="fa-solid fa-bolt"></i></div>
                </div>
                <div class="kpi-value" id="kpi-capacity">0</div>
                <div style="font-size:0.8rem; color:var(--text-secondary); margin-top:4px;">Gigawatts (GW)</div>
            </div>
            
            <div class="kpi-card" style="--card-color: #8b5cf6;">
                <div class="kpi-header">
                    <span class="kpi-title">Total Projects</span>
                    <div class="kpi-icon"><i class="fa-solid fa-industry"></i></div>
                </div>
                <div class="kpi-value" id="kpi-count">0</div>
                <div style="font-size:0.8rem; color:var(--text-secondary); margin-top:4px;">Global Assets</div>
            </div>
            
            <div class="kpi-card" style="--card-color: #10b981;">
                <div class="kpi-header">
                    <span class="kpi-title">Operational</span>
                    <div class="kpi-icon"><i class="fa-solid fa-check-circle"></i></div>
                </div>
                <div class="kpi-value" id="kpi-operational">0</div>
                <div style="font-size:0.8rem; color:var(--text-secondary); margin-top:4px;">Generating Power</div>
            </div>
        </section>

        <!-- Map Section -->
        <section class="map-wrapper">
            <div id="map"></div>
        </section>

        <!-- Detailed Data Table Section -->
        <section class="details-section">
            <div class="details-header">
                <div class="details-title"><i class="fa-solid fa-table-list" style="margin-right:8px; color:var(--text-secondary);"></i> Project Database</div>
                <small style="font-weight: normal; font-size: 0.85rem; color: var(--text-secondary);">
                    Showing filtered results based on sidebar selection
                </small>
            </div>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Project Name</th>
                            <th>Country</th>
                            <th>Status</th>
                            <th>Capacity (MW)</th>
                            <th>Developer / Owner</th>
                            <th>Coordinates</th>
                        </tr>
                    </thead>
                    <tbody id="details-table-body">
                        <!-- Rows will be populated by JS -->
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <!-- JavaScript Logic -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // --- Step 1: Real-world Data (Includes Planned Projects) ---
        const rawData = [
            // Asia - Taiwan
            { id: 1, name: "Formosa 1 (海洋風電)", country: "Taiwan", lat: 24.7100, lng: 120.8300, capacityMW: 128, status: "Operational", developer: "Orsted/JERA/Macquarie" },
            { id: 2, name: "Formosa 2 (海能風電)", country: "Taiwan", lat: 24.6500, lng: 120.7400, capacityMW: 376, status: "Operational", developer: "JERA/Macquarie" },
            { id: 3, name: "Greater Changhua 1 & 2a (大彰化東南/西南)", country: "Taiwan", lat: 24.0600, lng: 120.0100, capacityMW: 900, status: "Operational", developer: "Orsted" },
            { id: 4, name: "Changfang & Xidao (彰芳西島)", country: "Taiwan", lat: 24.0500, lng: 119.9200, capacityMW: 600, status: "Operational", developer: "CIP" },
            { id: 5, name: "Zhong Neng (中能)", country: "Taiwan", lat: 24.0300, lng: 120.1500, capacityMW: 300, status: "Operational", developer: "CSC/CIP" },
            { id: 6, name: "Yunlin (雲林離岸風場)", country: "Taiwan", lat: 23.5500, lng: 120.0700, capacityMW: 640, status: "Partially Operational", developer: "Skyborn" },
            { id: 7, name: "Hai Long (海龍 2A/2B/3)", country: "Taiwan", lat: 24.1500, lng: 119.8500, capacityMW: 1044, status: "Under Construction", developer: "Northland/Mitsui" },
            { id: 8, name: "Greater Changhua 2b & 4 (大彰化西北/東北)", country: "Taiwan", lat: 24.1000, lng: 119.9000, capacityMW: 920, status: "Under Construction", developer: "Orsted" },
            { id: 9, name: "Formosa 4 (Haishang)", country: "Taiwan", lat: 24.646, lng: 120.476, capacityMW: 490, status: "Under Construction", developer: "Swancor/SRE" },

            // Asia - Japan
            { id: 10, name: "Akita Noshiro (秋田能代)", country: "Japan", lat: 40.2000, lng: 140.0000, capacityMW: 140, status: "Operational", developer: "Marubeni" },

            // Asia - China
            { id: 11, name: "SPIC Binhai North H1", country: "China", lat: 34.1500, lng: 120.2500, capacityMW: 100, status: "Operational", developer: "SPIC" },
            { id: 12, name: "SPIC Binhai North H2", country: "China", lat: 34.3000, lng: 120.3000, capacityMW: 400, status: "Operational", developer: "SPIC" },
            { id: 13, name: "Three Gorges Yangjiang Shapa 1-5", country: "China", lat: 21.3000, lng: 111.6000, capacityMW: 1700, status: "Operational", developer: "CTG" },
            { id: 14, name: "Rudong H6", country: "China", lat: 32.5000, lng: 121.5000, capacityMW: 400, status: "Operational", developer: "CGN" },

            // Europe - UK
            { id: 15, name: "Hornsea One", country: "United Kingdom", lat: 53.8800, lng: 1.8800, capacityMW: 1218, status: "Operational", developer: "Orsted" },
            { id: 16, name: "Hornsea Two", country: "United Kingdom", lat: 53.9300, lng: 1.8300, capacityMW: 1320, status: "Operational", developer: "Orsted" },
            { id: 17, name: "Hornsea Three", country: "United Kingdom", lat: 53.8600, lng: 2.5300, capacityMW: 2900, status: "Under Construction", developer: "Orsted" },
            { id: 18, name: "Dogger Bank A", country: "United Kingdom", lat: 54.7700, lng: 1.9100, capacityMW: 1200, status: "Partially Operational", developer: "SSE/Equinor" },
            { id: 19, name: "Dogger Bank B", country: "United Kingdom", lat: 54.9800, lng: 1.6600, capacityMW: 1200, status: "Under Construction", developer: "SSE/Equinor" },
            { id: 20, name: "Dogger Bank C", country: "United Kingdom", lat: 55.0300, lng: 2.4600, capacityMW: 1200, status: "Under Construction", developer: "SSE/Equinor" },
            { id: 21, name: "Seagreen", country: "United Kingdom", lat: 56.5800, lng: -1.7300, capacityMW: 1075, status: "Operational", developer: "SSE/TotalEnergies" },
            { id: 22, name: "Moray East", country: "United Kingdom", lat: 58.1800, lng: -2.7100, capacityMW: 950, status: "Operational", developer: "Ocean Winds" },
            { id: 23, name: "Moray West", country: "United Kingdom", lat: 58.0500, lng: -3.0000, capacityMW: 882, status: "Under Construction", developer: "Ocean Winds" },
            { id: 24, name: "Triton Knoll", country: "United Kingdom", lat: 53.4800, lng: 0.8500, capacityMW: 857, status: "Operational", developer: "RWE" },
            { id: 25, name: "London Array", country: "United Kingdom", lat: 51.6400, lng: 1.5500, capacityMW: 630, status: "Operational", developer: "RWE/Orsted" },
            { id: 26, name: "Gwynt y Môr", country: "United Kingdom", lat: 53.4600, lng: -3.6300, capacityMW: 576, status: "Operational", developer: "RWE" },
            { id: 27, name: "Walney Extension", country: "United Kingdom", lat: 54.0400, lng: -3.7500, capacityMW: 659, status: "Operational", developer: "Orsted" },
            { id: 28, name: "Race Bank", country: "United Kingdom", lat: 53.2700, lng: 0.8300, capacityMW: 573, status: "Operational", developer: "Orsted" },
            { id: 29, name: "Greater Gabbard", country: "United Kingdom", lat: 51.8800, lng: 1.9300, capacityMW: 504, status: "Operational", developer: "SSE/RWE" },
            { id: 30, name: "Galloper", country: "United Kingdom", lat: 51.8900, lng: 2.0400, capacityMW: 353, status: "Operational", developer: "RWE" },
            { id: 31, name: "Sheringham Shoal", country: "United Kingdom", lat: 53.1300, lng: 1.1500, capacityMW: 317, status: "Operational", developer: "Equinor" },

            // Europe - Netherlands
            { id: 32, name: "Hollandse Kust Zuid 1-4", country: "Netherlands", lat: 52.3700, lng: 4.2500, capacityMW: 1500, status: "Operational", developer: "Vattenfall" },
            { id: 33, name: "Hollandse Kust Noord", country: "Netherlands", lat: 52.7100, lng: 4.2800, capacityMW: 759, status: "Operational", developer: "CrossWind" },
            { id: 34, name: "Borssele 1 & 2", country: "Netherlands", lat: 51.7200, lng: 3.0300, capacityMW: 752, status: "Operational", developer: "Orsted" },
            { id: 35, name: "Borssele 3 & 4", country: "Netherlands", lat: 51.7600, lng: 2.9500, capacityMW: 731, status: "Operational", developer: "Blauwwind" },
            { id: 36, name: "Gemini", country: "Netherlands", lat: 54.0300, lng: 5.9600, capacityMW: 600, status: "Operational", developer: "Northland" },

            // Europe - Germany
            { id: 37, name: "Gode Wind 1 & 2", country: "Germany", lat: 54.0700, lng: 7.0300, capacityMW: 582, status: "Operational", developer: "Orsted" },
            { id: 38, name: "Gode Wind 3", country: "Germany", lat: 54.1000, lng: 7.1000, capacityMW: 242, status: "Under Construction", developer: "Orsted" },
            { id: 39, name: "Borkum Riffgrund 1", country: "Germany", lat: 53.9700, lng: 6.5500, capacityMW: 312, status: "Operational", developer: "Orsted" },
            { id: 40, name: "Borkum Riffgrund 2", country: "Germany", lat: 53.9800, lng: 6.4800, capacityMW: 450, status: "Operational", developer: "Orsted" },
            { id: 41, name: "Borkum Riffgrund 3", country: "Germany", lat: 54.0000, lng: 6.4000, capacityMW: 900, status: "Under Construction", developer: "Orsted" },
            { id: 42, name: "EnBW Hohe See", country: "Germany", lat: 54.4300, lng: 6.3200, capacityMW: 497, status: "Operational", developer: "EnBW" },
            { id: 43, name: "EnBW Albatros", country: "Germany", lat: 54.5000, lng: 6.4000, capacityMW: 112, status: "Operational", developer: "EnBW" },
            { id: 44, name: "Global Tech I", country: "Germany", lat: 54.5000, lng: 6.2300, capacityMW: 400, status: "Operational", developer: "Global Tech" },
            { id: 45, name: "BARD Offshore 1", country: "Germany", lat: 54.3600, lng: 5.9800, capacityMW: 400, status: "Operational", developer: "Ocean Breeze" },
            { id: 46, name: "Nordsee One", country: "Germany", lat: 53.9700, lng: 6.8000, capacityMW: 332, status: "Operational", developer: "RWE" },
            { id: 47, name: "Amrumbank West", country: "Germany", lat: 54.5000, lng: 7.8000, capacityMW: 302, status: "Operational", developer: "RWE" },
            { id: 48, name: "Wikinger", country: "Germany", lat: 54.8300, lng: 14.0700, capacityMW: 350, status: "Operational", developer: "Iberdrola" },
            { id: 49, name: "Arkona", country: "Germany", lat: 54.7800, lng: 14.2000, capacityMW: 385, status: "Operational", developer: "RWE/Equinor" },

            // Europe - Denmark
            { id: 50, name: "Kriegers Flak", country: "Denmark", lat: 55.0200, lng: 12.8700, capacityMW: 600, status: "Operational", developer: "Vattenfall" },
            { id: 51, name: "Horns Rev 3", country: "Denmark", lat: 55.7000, lng: 7.6500, capacityMW: 407, status: "Operational", developer: "Vattenfall" },
            { id: 52, name: "Horns Rev 2", country: "Denmark", lat: 55.6000, lng: 7.5800, capacityMW: 209, status: "Operational", developer: "Orsted" },
            { id: 53, name: "Anholt", country: "Denmark", lat: 56.6000, lng: 11.2000, capacityMW: 400, status: "Operational", developer: "Orsted" },
            { id: 54, name: "Vesterhav Syd & Nord", country: "Denmark", lat: 56.3000, lng: 8.1000, capacityMW: 344, status: "Operational", developer: "Vattenfall" },

            // Europe - Belgium
            { id: 55, name: "SeaMade", country: "Belgium", lat: 51.7000, lng: 2.7500, capacityMW: 487, status: "Operational", developer: "Otary" },
            { id: 56, name: "Norther", country: "Belgium", lat: 51.5300, lng: 3.0300, capacityMW: 370, status: "Operational", developer: "Elicio" },

            // Europe - France
            { id: 57, name: "Saint-Nazaire", country: "France", lat: 47.1600, lng: -2.6000, capacityMW: 480, status: "Operational", developer: "EDF/Enbridge" },
            { id: 58, name: "Saint-Brieuc", country: "France", lat: 48.8500, lng: -2.5500, capacityMW: 496, status: "Operational", developer: "Iberdrola" },
            { id: 59, name: "Fecamp", country: "France", lat: 49.9000, lng: 0.2200, capacityMW: 497, status: "Operational", developer: "EDF" },

            // Europe - Poland
            { id: 60, name: "Baltic Power", country: "Poland", lat: 54.9500, lng: 17.6500, capacityMW: 1140, status: "Under Construction", developer: "Orlen/Northland" },

            // North America - USA
            { id: 61, name: "Vineyard Wind 1", country: "USA", lat: 41.0500, lng: -70.5300, capacityMW: 800, status: "Partially Operational", developer: "Avangrid/CIP" },
            { id: 62, name: "South Fork Wind", country: "USA", lat: 41.0800, lng: -71.2200, capacityMW: 132, status: "Operational", developer: "Orsted" },
            { id: 63, name: "Block Island", country: "USA", lat: 41.1200, lng: -71.5100, capacityMW: 30, status: "Operational", developer: "Orsted" },
            { id: 64, name: "Coastal Virginia (CVOW Pilot)", country: "USA", lat: 36.8800, lng: -75.4800, capacityMW: 12, status: "Operational", developer: "Dominion" },
            { id: 65, name: "Coastal Virginia (CVOW Commercial)", country: "USA", lat: 36.9000, lng: -75.3800, capacityMW: 2640, status: "Under Construction", developer: "Dominion" },

            // Restored Planned Projects
            { id: 101, name: "Thor", country: "Denmark", lat: 56.3500, lng: 7.6500, capacityMW: 1000, status: "Planned", developer: "RWE" },
            { id: 102, name: "Empire Wind 1 & 2", country: "USA", lat: 40.2800, lng: -73.6000, capacityMW: 2076, status: "Planned", developer: "Equinor/BP" },
            { id: 103, name: "Star of the South", country: "Australia", lat: -38.7000, lng: 147.1000, capacityMW: 2200, status: "Planned", developer: "CIP" }
        ];

        // --- Step 2: Map Initialization ---
        const defaultView = { lat: 24.65, lng: 120.5, zoom: 11 };
        let map; // Define map globally

        // Initialize Map
        map = L.map('map', {
            zoomControl: false 
        }).setView([defaultView.lat, defaultView.lng], defaultView.zoom); 

        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 19
        }).addTo(map);
        
        L.control.zoom({ position: 'bottomright' }).addTo(map);

        const markersLayer = L.layerGroup().addTo(map);

        // --- Step 3: Visualization Helpers ---
        function getColorByStatus(status) {
            // CSS Variable Matching
            switch(status) {
                case 'Operational': return '#10b981';       // Emerald
                case 'Partially Operational': return '#0d9488'; // Teal
                case 'Under Construction': return '#f59e0b'; // Amber
                case 'Planned': return '#6366f1';           // Indigo
                default: return '#94a3b8';                  // Slate
            }
        }

        function getRadiusByCapacity(mw) {
            return Math.sqrt(mw) / 2.5; 
        }

        // --- Step 4: Core Render Function (Map) ---
        function renderMap(data) {
            markersLayer.clearLayers();

            data.forEach(farm => {
                const marker = L.circleMarker([farm.lat, farm.lng], {
                    radius: getRadiusByCapacity(farm.capacityMW),
                    fillColor: getColorByStatus(farm.status),
                    color: "#fff",
                    weight: 2, // Thicker white border for contrast
                    opacity: 1,
                    fillOpacity: 0.8
                });

                const contentHtml = `
                    <div class="custom-tooltip">
                        <div class="tooltip-header">${farm.name}</div>
                        <div class="tooltip-body">
                            <div class="tooltip-row"><span class="tooltip-label">Country</span> <span class="tooltip-val">${farm.country}</span></div>
                            <div class="tooltip-row"><span class="tooltip-label">Capacity</span> <span class="tooltip-val">${farm.capacityMW} MW</span></div>
                            <div class="tooltip-row"><span class="tooltip-label">Developer</span> <span class="tooltip-val">${farm.developer}</span></div>
                            <div class="tooltip-row" style="margin-top:8px;">
                                <span class="status-badge" style="background:${getColorByStatus(farm.status)}; color:white; width:100%; justify-content:center;">${farm.status}</span>
                            </div>
                        </div>
                    </div>
                `;
                
                marker.bindTooltip(contentHtml, { direction: 'top', offset: [0, -10] });
                marker.bindPopup(contentHtml);

                marker.on('click', function(e) {
                    map.setView(e.latlng, 10); 
                    this.openPopup();
                    renderTable([farm]); 
                });

                marker.addTo(markersLayer);
            });
            
            // Draw Formosa 4 Boundary if present
            const hasF4 = data.find(d => d.name.includes("Formosa 4"));
            if(hasF4) drawFormosa4Boundary();
        }

        // --- Render Table Function ---
        function renderTable(data) {
            const tbody = document.getElementById('details-table-body');
            tbody.innerHTML = ''; 

            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align:center; padding: 32px; color:#64748b;">No projects found matching criteria.</td></tr>';
                return;
            }

            data.forEach(farm => {
                const row = document.createElement('tr');
                const badgeColor = getColorByStatus(farm.status);
                const badgeHtml = `<span class="status-badge" style="background-color: ${badgeColor}; color: white;">${farm.status}</span>`;

                row.innerHTML = `
                    <td style="font-weight:600; color:#334155;">${farm.name}</td>
                    <td>${farm.country}</td>
                    <td>${badgeHtml}</td>
                    <td style="font-family:'Courier New', monospace; font-weight:600;">${farm.capacityMW.toLocaleString()}</td>
                    <td>${farm.developer}</td>
                    <td style="font-family:'Courier New', monospace; font-size:0.8rem; color:#64748b;">${farm.lat.toFixed(3)}, ${farm.lng.toFixed(3)}</td>
                `;
                
                row.addEventListener('click', () => {
                   map.setView([farm.lat, farm.lng], 11);
                });
                
                tbody.appendChild(row);
            });
        }

        // --- Special Feature: Formosa 4 Boundary ---
        function drawFormosa4Boundary() {
            const formosa4Coords = [
                [24.71503, 120.52145], [24.69670, 120.54600], [24.63355, 120.49882], 
                [24.63240, 120.49065], [24.62967, 120.47622], [24.62688, 120.46400], 
                [24.62392, 120.45232], [24.62063, 120.44087], [24.61662, 120.42935], 
                [24.66550, 120.44620]
            ];

            const polygon = L.polygon(formosa4Coords, {
                color: '#f59e0b', weight: 2, fillColor: '#f59e0b', fillOpacity: 0.15, dashArray: '5, 5'
            });

            const f4PopupContent = `
                <div class="custom-tooltip">
                    <div class="tooltip-header">Formosa 4 (Haishang)</div>
                    <div class="tooltip-body">
                        <div class="tooltip-row"><span class="tooltip-label">Country</span> <span class="tooltip-val">Taiwan</span></div>
                        <div class="tooltip-row"><span class="tooltip-label">Capacity</span> <span class="tooltip-val">490 MW</span></div>
                        <div class="tooltip-row"><span class="tooltip-label">Developer</span> <span class="tooltip-val">Swancor/SRE</span></div>
                        <div class="tooltip-row" style="margin-top:8px;">
                            <span class="status-badge" style="background:#f59e0b; color:white;">Under Construction</span>
                        </div>
                    </div>
                </div>
            `;
            
            polygon.bindTooltip("Formosa 4 (Haishang) - Project Boundary", { sticky: true });
            polygon.bindPopup(f4PopupContent);
            
            polygon.on('click', function(e) {
                map.fitBounds(polygon.getBounds()); 
                const f4Data = rawData.find(d => d.name.includes("Formosa 4"));
                if (f4Data) {
                    renderTable([f4Data]);
                }
            });

            polygon.addTo(markersLayer);
        }

        function updateKPIs(data) {
            const totalMW = data.reduce((sum, item) => sum + item.capacityMW, 0);
            const totalGW = (totalMW / 1000).toFixed(2);
            const totalCount = data.length;
            
            const operationalCount = data.filter(item => item.status === 'Operational').length;

            // Animate Numbers (Simple)
            document.getElementById('kpi-capacity').innerText = totalGW;
            document.getElementById('kpi-count').innerText = totalCount;
            document.getElementById('kpi-operational').innerText = operationalCount;
        }

        // --- Step 5: Filters & Event Listeners ---
        function initFilters() {
            const statusSelect = document.getElementById('statusFilter');
            const countrySelect = document.getElementById('countryFilter');

            const statuses = [...new Set(rawData.map(d => d.status))];
            const countries = [...new Set(rawData.map(d => d.country))].sort();

            statuses.forEach(status => {
                const option = document.createElement('option');
                option.value = status;
                option.innerText = status;
                statusSelect.appendChild(option);
            });

            countries.forEach(country => {
                const option = document.createElement('option');
                option.value = country;
                option.innerText = country;
                countrySelect.appendChild(option);
            });

            statusSelect.addEventListener('change', filterData);
            countrySelect.addEventListener('change', filterData);
        }

        function filterData() {
            const statusVal = document.getElementById('statusFilter').value;
            const countryVal = document.getElementById('countryFilter').value;

            const filteredData = rawData.filter(item => {
                const matchStatus = (statusVal === 'all') || (item.status === statusVal);
                const matchCountry = (countryVal === 'all') || (item.country === countryVal);
                return matchStatus && matchCountry;
            });

            renderMap(filteredData);
            updateKPIs(filteredData);
            renderTable(filteredData);

            if (countryVal !== 'all') {
                const bounds = L.latLngBounds(filteredData.map(d => [d.lat, d.lng]));
                if (bounds.isValid()) {
                    map.fitBounds(bounds, { padding: [50, 50], maxZoom: 10 });
                }
            } else {
                 map.setView([20, 10], 2); 
            }
        }

        // --- Step 6: Legend (English) ---
        function addLegend() {
            const legend = L.control({position: 'bottomleft'});
            legend.onAdd = function (map) {
                const div = L.DomUtil.create('div', 'legend');
                div.innerHTML += '<strong>Project Status</strong>';
                div.innerHTML += '<div class="legend-item"><i style="background: #10b981"></i> Operational</div>';
                div.innerHTML += '<div class="legend-item"><i style="background: #0d9488"></i> Partially Operational</div>';
                div.innerHTML += '<div class="legend-item"><i style="background: #f59e0b"></i> Under Construction</div>';
                div.innerHTML += '<div class="legend-item"><i style="background: #6366f1"></i> Planned</div>';
                div.innerHTML += '<hr style="margin:8px 0; border-top:1px solid #e2e8f0;">';
                div.innerHTML += '<div style="font-size:0.75rem; color:#64748b;">* Size represents Capacity (MW)</div>';
                return div;
            };
            legend.addTo(map);
        }

        // --- Step 7: Sidebar Resize Logic ---
        function initResize() {
            const sidebar = document.getElementById('sidebar');
            const resizer = document.getElementById('resizer');
            let isResizing = false;

            resizer.addEventListener('mousedown', (e) => {
                isResizing = true;
                resizer.classList.add('resizing');
                document.body.style.cursor = 'col-resize'; 
                document.addEventListener('mousemove', handleMouseMove);
                document.addEventListener('mouseup', stopResize);
                e.preventDefault(); 
            });

            function handleMouseMove(e) {
                if (!isResizing) return;
                const newWidth = e.clientX;
                sidebar.style.width = `${newWidth}px`;
            }

            function stopResize() {
                isResizing = false;
                resizer.classList.remove('resizing');
                document.body.style.cursor = 'default';
                document.removeEventListener('mousemove', handleMouseMove);
                document.removeEventListener('mouseup', stopResize);
            }
        }

        // --- Entry Point ---
        window.onload = function() {
            initFilters();      
            renderMap(rawData); 
            updateKPIs(rawData);
            renderTable(rawData);
            addLegend();
            initResize(); 
        };

    </script>
</body>
</html>
